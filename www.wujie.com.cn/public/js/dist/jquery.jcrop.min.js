!function(e){e.Jcrop=function(t,n){function r(e){return Math.round(e)+"px"}function o(e){return J.baseClass+"-"+e}function a(){return e.fx.step.hasOwnProperty("backgroundColor")}function i(t){var n=e(t).offset();return[n.left,n.top]}function s(e){return[e.pageX-P[0],e.pageY-P[1]]}function c(t){"object"!=typeof t&&(t={}),J=e.extend(J,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof J[t]&&(J[t]=function(){})})}function u(e,t,n){if(P=i(L),pe.setCursor("move"===e?e:e+"-resize"),"move"===e)return pe.activateHandlers(l(t),b,n);var r=le.getFixed(),o=h(e),a=le.getCorner(h(o));le.setPressed(le.getCorner(o)),le.setCurrent(a),pe.activateHandlers(d(e,r),b,n)}function d(e,t){return function(n){if(J.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}le.setCurrent(n),fe.update()}}function l(e){var t=e;return ge.watchKeys(),function(e){le.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,fe.update()}}function h(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function f(e){return function(t){return!J.disabled&&(!("move"===e&&!J.allowMove)&&(P=i(L),re=!0,u(e,s(t)),t.stopPropagation(),t.preventDefault(),!1))}}function p(e,t,n){var r=e.width(),o=e.height();r>t&&t>0&&(r=t,o=t/e.width()*e.height()),o>n&&n>0&&(o=n,r=n/e.height()*e.width()),te=e.width()/r,ne=e.height()/o,e.width(r).height(o)}function g(e){return{x:parseInt(e.x*te),y:parseInt(e.y*ne),x2:parseInt(e.x2*te),y2:parseInt(e.y2*ne),w:parseInt(e.w*te),h:parseInt(e.h*ne)}}function b(e){var t=le.getFixed();t.w>J.minSelect[0]&&t.h>J.minSelect[1]?(fe.enableHandles(),fe.done()):fe.release(),pe.setCursor(J.allowSelect?"crosshair":"default")}function w(e){if(J.disabled)return!1;if(!J.allowSelect)return!1;re=!0,P=i(L),fe.disableHandles(),pe.setCursor("crosshair");var t=s(e);return le.setPressed(t),fe.update(),pe.activateHandlers(v,b,"touch"===e.type.substring(0,5)),ge.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function v(e){le.setCurrent(e),fe.update()}function y(){var t=e("<div></div>").addClass(o("tracker"));return R&&t.css({opacity:0,backgroundColor:"white"}),t}function m(e){G.removeClass().addClass(o("holder")).addClass(e)}function x(e,t){function n(){window.setTimeout(v,l)}var r=e[0]/te,o=e[1]/ne,a=e[2]/te,i=e[3]/ne;if(!oe){var s=le.flipCoords(r,o,a,i),c=le.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=J.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=J.swingSpeed;r=d[0],o=d[1],a=d[2],i=d[3],fe.animMode(!0);var v=function(){return function(){b+=(100-b)/w,d[0]=Math.round(r+b/100*h),d[1]=Math.round(o+b/100*f),d[2]=Math.round(a+b/100*p),d[3]=Math.round(i+b/100*g),b>=99.8&&(b=100),b<100?(S(d),n()):(fe.done(),fe.animMode(!1),"function"==typeof t&&t.call(be))}}();n()}}function C(e){S([e[0]/te,e[1]/ne,e[2]/te,e[3]/ne]),J.onSelect.call(be,g(le.getFixed())),fe.enableHandles()}function S(e){le.setPressed([e[0],e[1]]),le.setCurrent([e[2],e[3]]),fe.update()}function k(){return g(le.getFixed())}function z(){return le.getFixed()}function M(e){c(e),B()}function O(){J.disabled=!0,fe.disableHandles(),fe.setCursor("default"),pe.setCursor("default")}function I(){J.disabled=!1,B()}function j(){fe.done(),pe.activateHandlers(null,null)}function F(){G.remove(),E.show(),E.css("visibility","visible"),e(t).removeData("Jcrop")}function H(e,t){fe.release(),O();var n=new Image;n.onload=function(){var r=n.width,o=n.height,a=J.boxWidth,i=J.boxHeight;L.width(r).height(o),L.attr("src",e),N.attr("src",e),p(L,a,i),X=L.width(),Y=L.height(),N.width(X).height(Y),se.width(X+2*ie).height(Y+2*ie),G.width(X).height(Y),he.resize(X,Y),I(),"function"==typeof t&&t.call(be)},n.src=e}function D(e,t,n){var r=t||J.bgColor;J.bgFade&&a()&&J.fadeTime&&!n?e.animate({backgroundColor:r},{queue:!1,duration:J.fadeTime}):e.css("backgroundColor",r)}function B(e){J.allowResize?e?fe.enableOnly():fe.enableHandles():fe.disableHandles(),pe.setCursor(J.allowSelect?"crosshair":"default"),fe.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(te=J.trueSize[0]/X,ne=J.trueSize[1]/Y),J.hasOwnProperty("setSelect")&&(C(J.setSelect),fe.done(),delete J.setSelect),he.refresh(),J.bgColor!=ce&&(D(J.shade?he.getShades():G,J.shade?J.shadeColor||J.bgColor:J.bgColor),ce=J.bgColor),ue!=J.bgOpacity&&(ue=J.bgOpacity,J.shade?he.refresh():fe.setBgOpacity(ue)),Z=J.maxSize[0]||0,$=J.maxSize[1]||0,_=J.minSize[0]||0,ee=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(L.attr("src",J.outerImage),delete J.outerImage),fe.refresh()}var P,J=e.extend({},e.Jcrop.defaults),A=navigator.userAgent.toLowerCase(),R=/msie/.test(A),T=/msie [1-6]\./.test(A);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),c(n);var K={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},E=e(t),W=!0;if("IMG"==t.tagName){if(0!=E[0].width&&0!=E[0].height)E.width(E[0].width),E.height(E[0].height);else{var q=new Image;q.src=E[0].src,E.width(q.width),E.height(q.height)}var L=E.clone().removeAttr("id").css(K).show();L.width(E.width()),L.height(E.height()),E.after(L).hide()}else L=E.css(K).show(),W=!1,null===J.shade&&(J.shade=!0);p(L,J.boxWidth,J.boxHeight);var X=L.width(),Y=L.height(),G=e("<div />").width(X).height(Y).addClass(o("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(E).append(L);J.addClass&&G.addClass(J.addClass);var N=e("<div />"),V=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Q=e("<div />").width("100%").height("100%").css({zIndex:320}),U=e('<div id="small" />').css({position:"absolute",zIndex:600}).dblclick(function(){var e=le.getFixed();J.onDblClick.call(be,e)}).insertBefore(L).append(V,Q);W&&(N=e("<img />").attr("src",L.attr("src")).css(K).width(X).height(Y),V.append(N));var Z,$,_,ee,te,ne,re,oe,ae,ie=J.boundary,se=y().width(X+2*ie).height(Y+2*ie).css({position:"absolute",top:r(-ie),left:r(-ie),zIndex:290}).mousedown(w),ce=J.bgColor,ue=J.bgOpacity;P=i(L);var de=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],r=document.createElement("div");try{for(e=0;e<n.length;e++){var o=n[e];o="on"+o;var a=o in r;a||(r.setAttribute(o,"return;"),a="function"==typeof r[o]),t[n[e]]=a}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}function t(){return J.touchSupport===!0||J.touchSupport===!1?J.touchSupport:e()}return{createDragger:function(e){return function(t){return!J.disabled&&(!("move"===e&&!J.allowMove)&&(P=i(L),re=!0,u(e,s(de.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1))}},newSelection:function(e){return w(de.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),le=function(){function e(e){e=i(e),p=h=e[0],g=f=e[1]}function t(e){e=i(e),d=e[0]-p,l=e[1]-g,p=e[0],g=e[1]}function n(){return[d,l]}function r(e){var t=e[0],n=e[1];0>h+t&&(t-=t+h),0>f+n&&(n-=n+f),Y<g+n&&(n+=Y-(g+n)),X<p+t&&(t+=X-(p+t)),h+=t,p+=t,f+=n,g+=n}function o(e){var t=a();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function a(){if(!J.aspectRatio)return c();var e,t,n,r,o=J.aspectRatio,a=J.minSize[0]/te,i=(J.minSize[1]/ne,J.maxSize[0]/te),d=J.maxSize[1]/ne,l=p-h,b=g-f,w=Math.abs(l),v=Math.abs(b),y=w/v;return 0===i&&(i=10*X),0===d&&(d=10*Y),y<o?(t=g,n=v*o,e=l<0?h-n:n+h,e<0?(e=0,r=Math.abs((e-h)/o),t=b<0?f-r:r+f):e>X&&(e=X,r=Math.abs((e-h)/o),t=b<0?f-r:r+f)):(e=p,r=w/o,t=b<0?f-r:f+r,t<0?(t=0,n=Math.abs((t-f)*o),e=l<0?h-n:n+h):t>Y&&(t=Y,n=Math.abs(t-f)*o,e=l<0?h-n:n+h)),e>h?(e-h<a?e=h+a:e-h>i&&(e=h+i),t=t>f?f+(e-h)/o:f-(e-h)/o):e<h&&(h-e<a?e=h-a:h-e>i&&(e=h-i),t=t>f?f+(h-e)/o:f-(h-e)/o),e<0?(h-=e,e=0):e>X&&(h-=e-X,e=X),t<0?(f-=t,t=0):t>Y&&(f-=t-Y,t=Y),u(s(h,f,e,t))}function i(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>X&&(e[0]=X),e[1]>Y&&(e[1]=Y),[Math.round(e[0]),Math.round(e[1])]}function s(e,t,n,r){var o=e,a=n,i=t,s=r;return n<e&&(o=n,a=e),r<t&&(i=r,s=t),[o,i,a,s]}function c(){var e,t=p-h,n=g-f;return Z&&Math.abs(t)>Z&&(p=t>0?h+Z:h-Z),$&&Math.abs(n)>$&&(g=n>0?f+$:f-$),ee/ne&&Math.abs(n)<ee/ne&&(g=n>0?f+ee/ne:f-ee/ne),_/te&&Math.abs(t)<_/te&&(p=t>0?h+_/te:h-_/te),h<0&&(p-=h,h-=h),f<0&&(g-=f,f-=f),p<0&&(h-=p,p-=p),g<0&&(f-=g,g-=g),p>X&&(e=p-X,h-=e,p-=e),g>Y&&(e=g-Y,f-=e,g-=e),h>X&&(e=h-Y,g-=e,f-=e),f>Y&&(e=f-Y,g-=e,f-=e),u(s(h,f,p,g))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d,l,h=0,f=0,p=0,g=0;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:r,getCorner:o,getFixed:a}}(),he=function(){function t(e,t){p.left.css({height:r(t)}),p.right.css({height:r(t)})}function n(){return o(le.getFixed())}function o(e){p.top.css({left:r(e.x),width:r(e.w),height:r(e.y),top:0}),p.bottom.css({top:r(e.y2),left:r(e.x),width:r(e.w),height:r(Y-e.y2)}),p.right.css({left:r(e.x2),width:r(X-e.x2),top:0}),p.left.css({width:r(e.x),top:0,left:0})}function a(){return e("<div />").css({position:"absolute",backgroundColor:J.shadeColor||J.bgColor}).appendTo(f)}function i(){h||(h=!0,f.insertBefore(L),n(),fe.setBgOpacity(1,0,1),N.hide(),s(J.shadeColor||J.bgColor,1),fe.isAwake()?u(J.bgOpacity,1):u(1,1))}function s(e,t){D(l(),e,t)}function c(){h&&(f.remove(),N.show(),h=!1,fe.isAwake()?fe.setBgOpacity(J.bgOpacity,1,1):(fe.setBgOpacity(1,1,1),fe.disableHandles()),D(G,0,1))}function u(e,t){h&&(J.bgFade&&!t?f.animate({opacity:1-e},{queue:!1,duration:J.fadeTime}):f.css({opacity:1-e}))}function d(){J.shade?i():c(),fe.isAwake()&&u(J.bgOpacity)}function l(){return f.children()}var h=!1,f=e('<div id="opa" />').css({position:"absolute",zIndex:240,opacity:0,top:0,left:0,width:"100%",height:"100%"}),p={top:a(),left:a().height(Y),right:a().height(Y),bottom:a()};return{update:n,updateRaw:o,getShades:l,setBgColor:s,enable:i,disable:c,resize:t,refresh:d,opacity:u}}(),fe=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:J.borderOpacity}).addClass(o(t));return V.append(n),n}function n(t,n){var r=e("<div />").mousedown(f(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return de.support&&r.bind("touchstart.jcrop",de.createDragger(t)),Q.append(r),r}function a(t,n){var r=e("<div />").mousedown(f(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord2-"+t);return de.support&&r.bind("touchstart.jcrop",de.createDragger(t)),Q.append(r),r}function i(e){var t=J.handleSize,r=n(e,I++).css({opacity:J.handleOpacity}).addClass(o("handle"));return t&&r.width(t).height(t),r}function s(e){return a(e,I++).addClass("jcrop-dragbar")}function c(e){var t;for(t=0;t<e.length;t++)H[e[t]]=s(e[t])}function u(e){var n,r;for(r=0;r<e.length;r++){switch(e[r]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}j[e[r]]=t(n)}}function d(e){var t;for(t=0;t<e.length;t++)F[e[t]]=i(e[t])}function l(e,t){J.shade||N.css({top:r(-t),left:r(-e)}),U.css({top:r(t),left:r(e)})}function h(e,t){U.width(Math.round(e)).height(Math.round(t))}function p(){var e=le.getFixed();le.setPressed([e.x,e.y]),le.setCurrent([e.x2,e.y2]),b()}function b(e){if(O)return w(e)}function w(e){var t=le.getFixed();h(t.w,t.h),l(t.x,t.y),J.shade&&he.updateRaw(t),O||m(),e?J.onSelect.call(be,g(t)):J.onChange.call(be,g(t))}function v(e,t,n){(O||t)&&(J.bgFade&&!n?L.animate({opacity:e},{queue:!1,duration:J.fadeTime}):L.css("opacity",e))}function m(){U.show(),J.shade?he.opacity(ue):v(ue,!0),O=!0}function x(){k(),U.hide(),J.shade?he.opacity(1):v(1),O=!1,J.onRelease.call(be)}function C(){D&&Q.show()}function S(){if(D=!0,J.allowResize)return Q.show(),!0}function k(){D=!1,Q.hide()}function z(e){e?(oe=!0,k()):(oe=!1,S())}function M(){z(!1),p()}var O,I=370,j={},F={},H={},D=!1;e.isArray(J.createDragbars)&&c(J.createDragbars),e.isArray(J.createHandles)&&d(J.createHandles),J.drawBorders&&e.isArray(J.createBorders)&&u(J.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var B=y().mousedown(f("move")).css({cursor:"move",position:"absolute",zIndex:360});return de.support&&B.bind("touchstart.jcrop",de.createDragger("move")),V.append(B),k(),{updateVisible:b,update:w,release:x,refresh:p,isAwake:function(){return O},setCursor:function(e){B.css("cursor",e)},enableHandles:S,enableOnly:function(){D=!0},showHandles:C,disableHandles:k,animMode:z,setBgOpacity:v,done:M}}(),pe=function(){function t(t){se.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",i).bind("touchend.jcrop",c):h&&e(document).bind("mousemove.jcrop",r).bind("mouseup.jcrop",o)}function n(){se.css({zIndex:290}),e(document).unbind(".jcrop")}function r(e){return d(s(e)),!1}function o(e){return e.preventDefault(),e.stopPropagation(),re&&(re=!1,l(s(e)),fe.isAwake()&&J.onSelect.call(be,g(le.getFixed())),n(),d=function(){},l=function(){}),!1}function a(e,n,r){return re=!0,d=e,l=n,t(r),!1}function i(e){return d(s(de.cfilter(e))),!1}function c(e){return o(de.cfilter(e))}function u(e){se.css("cursor",e)}var d=function(){},l=function(){},h=J.trackDocument;return h||se.mousemove(r).mouseup(o).mouseout(o),L.before(se),{activateHandlers:a,setCursor:u}}(),ge=function(){function t(){J.keySupport&&(a.show(),a.focus())}function n(e){a.hide()}function r(e,t,n){J.allowMove&&(le.moveOffset([t,n]),fe.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function o(e){if(e.ctrlKey||e.metaKey)return!0;ae=!!e.shiftKey;var t=ae?10:1;switch(e.keyCode){case 37:r(e,-t,0);break;case 39:r(e,t,0);break;case 38:r(e,0,-t);break;case 40:r(e,0,t);break;case 27:J.allowSelect&&fe.release();break;case 9:return!0}return!1}var a=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),i=e("<div />").css({position:"absolute",overflow:"hidden"}).append(a);return J.keySupport&&(a.keydown(o).blur(n),T||!J.fixedSupport?(a.css({position:"absolute",left:"-20px"}),i.append(a).insertBefore(L)):a.insertBefore(L)),{watchKeys:t}}();de.support&&se.bind("touchstart.jcrop",de.newSelection),Q.hide(),B(!0);var be={setImage:H,animateTo:x,setSelect:C,setOptions:M,tellSelect:k,tellScaled:z,setClass:m,disable:O,enable:I,cancel:j,release:fe.release,destroy:F,focus:ge.watchKeys,getBounds:function(){return[X*te,Y*ne]},getWidgetSize:function(){return[X,Y]},getScaleFactor:function(){return[te,ne]},getOptions:function(){return J},ui:{holder:G,selection:U}};return R&&G.bind("selectstart",function(){return!1}),E.data("Jcrop",be),be},e.fn.Jcrop=function(t,n){var r;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r)}):(e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r))}),this},e.Jcrop.Loader=function(t,n,r){function o(){i.complete?(a.unbind(".jcloader"),e.isFunction(n)&&n.call(i)):window.setTimeout(o,50)}var a=e(t),i=a[0];a.bind("load.jcloader",o).bind("error.jcloader",function(t){a.unbind(".jcloader"),e.isFunction(r)&&r.call(i)}),i.complete&&e.isFunction(n)&&(a.unbind(".jcloader"),n.call(i))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!1,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:0,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);